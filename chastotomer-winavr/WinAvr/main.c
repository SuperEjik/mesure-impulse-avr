//***************************************************************************
//
//  Author(s)...: Pashgan    http://ChipEnable.Ru   
//
//  Target(s)...: ATMega8535
//
//  Compiler....: GNU GCC
//
//  Description.:  Проект частотомера.
//
//  Data........: 01.03.11 
//
//***************************************************************************
#include <avr/io.h>
#include <avr/interrupt.h>
#include "lcd_lib.h"
#include "bcd.h"
#include "timer.h"
#include "bits_macros.h"


int main(void)
{
  LCD_Init();
  TIM_Init();
  
  LCD_Goto(0,0);
  LCD_SendString("Freq: ");
  
  sei();
  while(1){
    //ждем установки флага от схемы захвата
    while(BitIsClear(TIFR, ICF1));
    //сохраняем значения таймеров
    Capt();
    
    //задержка в 1 секунду
    _delay_ms(1000);    
    
    //ждем установки флага от схемы захвата
    while(BitIsClear(TIFR, ICF1));
    //сохраняем значения таймеров
    Capt();

    //вычисляем значение частоты и выводим на lcd
    TIM_Calculation(); 
  }
  return 0;
}
